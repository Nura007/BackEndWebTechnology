<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Add Constructor</title>
  <link rel="stylesheet" href="/css/constructors.css">
</head>
<body>

<h1>Add Constructor</h1>

<!-- Form Card -->
<div class="card">
  <h2>New / Edit Constructor</h2>
  <input id="constructorId" type="hidden">
  <input id="pos" type="number" placeholder="Position">
  <input id="team" placeholder="Team Name">
  <input id="color" type="color" placeholder="Team Color">
  <input id="drivers" placeholder="Drivers (e.g. Verstappen / Perez)">
  <input id="points" type="number" placeholder="Points">
  <input id="wins" type="number" placeholder="Wins">
  <input id="podiums" type="number" placeholder="Podiums">
  <button onclick="saveConstructor()">Save Constructor</button>
</div>

<!-- List Card -->
<div class="card">
  <h2>Constructors List</h2>
  <ul id="constructors"></ul>
</div>

<script>
const apiUrl = '/api/constructors';

// Load all constructors
async function getConstructors() {
  const res = await fetch(apiUrl);
  const data = await res.json();
  const ul = document.getElementById('constructors');
  ul.innerHTML = '';

  data.forEach(c => {
    const li = document.createElement('li');
    li.style.background = c.color;
    li.style.color = '#fff';
    li.style.padding = '10px';
    li.style.marginBottom = '6px';
    li.style.borderRadius = '8px';
    li.style.display = 'flex';
    li.style.justifyContent = 'space-between';
    li.style.alignItems = 'center';

    li.innerHTML = `
      <span>#${c.position} ${c.team} | Drivers: ${c.drivers} | Points: ${c.points}</span>
      <span>
        <button onclick='editConstructor("${c._id}")'>Edit</button>
        <button onclick='deleteConstructor("${c._id}")'>Delete</button>
      </span>
    `;
    ul.appendChild(li);
  });
}

// Save Constructor (Create or Update)
async function saveConstructor() {
  const id = document.getElementById('constructorId').value;
  const data = {
    position: parseInt(document.getElementById('pos').value),
    team: document.getElementById('team').value,
    color: document.getElementById('color').value,
    drivers: document.getElementById('drivers').value,
    points: parseInt(document.getElementById('points').value) || 0,
    wins: parseInt(document.getElementById('wins').value) || 0,
    podiums: parseInt(document.getElementById('podiums').value) || 0,
    season: 2024
  };

  let res;
  if (id) {
    res = await fetch(`${apiUrl}/${id}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });
  } else {
    res = await fetch(apiUrl, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });
  }

  const result = await res.json();
  if (res.ok) {
    alert(`Constructor ${result.team} saved!`);
    resetForm();
    getConstructors();
  } else {
    alert(result.error);
  }
}

// Edit constructor: fill form
async function editConstructor(id) {
  const res = await fetch(`${apiUrl}/${id}`);
  const c = await res.json();

  document.getElementById('constructorId').value = c._id;
  document.getElementById('pos').value = c.position;
  document.getElementById('team').value = c.team;
  document.getElementById('color').value = c.color;
  document.getElementById('drivers').value = c.drivers;
  document.getElementById('points').value = c.points;
  document.getElementById('wins').value = c.wins;
  document.getElementById('podiums').value = c.podiums;
}

// Delete constructor
async function deleteConstructor(id) {
  if (!confirm('Are you sure you want to delete this constructor?')) return;
  const res = await fetch(`${apiUrl}/${id}`, { method: 'DELETE' });
  const result = await res.json();
  if (res.ok) {
    alert(result.message);
    getConstructors();
  } else {
    alert(result.error);
  }
}

// Reset form
function resetForm() {
  document.getElementById('constructorId').value = '';
  document.getElementById('pos').value = '';
  document.getElementById('team').value = '';
  document.getElementById('color').value = '#ffffff';
  document.getElementById('drivers').value = '';
  document.getElementById('points').value = '';
  document.getElementById('wins').value = '';
  document.getElementById('podiums').value = '';
}

// Load constructors on page load
window.onload = getConstructors;
</script>

</body>
</html>
