<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Items CRUD (MongoDB)</title>
  <link rel="stylesheet" href="/css/practice8.css">
</head>
<body>

<h1>Items CRUD</h1>

<div class="card">
  <h2>Add Item</h2>
  <input id="name" placeholder="Title">
  <input id="description" placeholder="Description">
  <input id="url" placeholder="URL">
  <button onclick="addItem()">Add</button>
</div>

<div class="card">
  <h2>Items List</h2>
  <button onclick="getItems()">Show All</button>
  <ul id="items"></ul>
</div>

<div class="card">
  <h2>Update Item</h2>
  <input id="updateId" placeholder="Item ID">
  <input id="updateName" placeholder="New Title">
  <input id="updateDescription" placeholder="New Description">
  <input id="updateUrl" placeholder="New URL">
  <button onclick="updateItem()">Update</button>
</div>

<div class="card">
  <h2>Delete Item</h2>
  <input id="deleteId" placeholder="Item ID">
  <button onclick="deleteItem()">Delete</button>
</div>

<script>
const apiUrl = '/api/items';

async function getItems() {
  const res = await fetch(apiUrl);
  const data = await res.json();
  const ul = document.getElementById('items');
  ul.innerHTML = '';
  data.forEach(item => {
    const li = document.createElement('li');
    li.textContent = `ID: ${item._id} | Title: ${item.title} | Description: ${item.description} | URL: ${item.url}`;
    ul.appendChild(li);
  });
}

async function addItem() {
  const title = document.getElementById('name').value;
  const description = document.getElementById('description').value;
  const url = document.getElementById('url').value;

  const res = await fetch(apiUrl, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ title, description, url })
  });

  const data = await res.json();
  alert('Item added: ' + data.title);
  getItems();
}

async function updateItem() {
  const id = document.getElementById('updateId').value;
  const title = document.getElementById('updateName').value;
  const description = document.getElementById('updateDescription').value;
  const url = document.getElementById('updateUrl').value;

  if (!id) return alert('Item ID is required!');

  const res = await fetch(`${apiUrl}/${id}`, {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ title, description, url })
  });

  const data = await res.json();
  if (res.ok) {
    alert('Item updated: ' + data.title);
    getItems();
  } else {
    alert('Error: ' + data.error);
  }
}

async function deleteItem() {
  const id = document.getElementById('deleteId').value;
  if (!id) return alert('Item ID is required!');

  const res = await fetch(`${apiUrl}/${id}`, { method: 'DELETE' });
  const data = await res.json();

  if (res.ok) {
    alert(data.message);
    getItems();
  } else {
    alert('Error: ' + data.error);
  }
}

getItems();
</script>
</body>
</html>
